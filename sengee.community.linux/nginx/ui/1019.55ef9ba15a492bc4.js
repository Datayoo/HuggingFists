"use strict";(self.webpackChunksengee_ui=self.webpackChunksengee_ui||[]).push([[1019],{31962:(b,E,c)=>{c.d(E,{e:()=>l});var y=c(57781),$=c(16817),P=c(40390);let l=(()=>{class N{constructor(){this.scope="",this.svgDasharray="none",this.svgEndCircle={x:0,y:0},this._setGroupEnable=!1,this.setWeightEnable=!1,this.jsonData={}}get setGroupEnable(){return this._setGroupEnable}set setGroupEnable(n){this._setGroupEnable=n,!n&&(this.setWeightEnable=!1)}get svgClass(){return this.mouseoverFlag?N.SVG_HIGHLIGHT_CLASS:N.SVG_NORMAL_CLASS}destroy(){this.from=this.to=this.controlPoints=this.jsonData=this._flowNode=null}initWithFlowPort(n,o){return n.portType===P._.TYPE_IN_PORT&&n.parentFlag===P._.PARENT_FNODE||n.portType===P._.TYPE_OUT_PORT&&n.parentFlag===P._.PARENT_CONTAINER||n.portType===P._.TYPE_TRIGGER_IN_PORT?(this.from=o,this.to=n):(this.from=n,this.to=o),(this.from.portType===P._.TYPE_TRIGGER_IN_PORT||this.from.portType===P._.TYPE_TRIGGER_OUT_PORT)&&(this.svgDasharray=N.SVG_DASHARRAY_TRIGGER),this.from.numFromConnection++,this.from.flowNode.newFlowPort(this.from),this.to.numToConnection++,this.to.flowNode.newFlowPort(this.to),this.updateJsonData(),this}updateOtherInfo(n){return this.group=n.group||n.$_group||"",this.weight=n.weight||n.$_weight||"",this.scope=n.scope||n.$_scope||"",this.checked=n.checked||n.$_checked||"",this}updateJsonData(){let n=this.from.flowNode==this.flowNode?$.j.PARENT:this.from.flowNode.id;this.jsonData.from=`${n}.${this.from.name}`,n=this.to.flowNode==this.flowNode?$.j.PARENT:this.to.flowNode.id,this.jsonData.to=`${n}.${this.to.name}`}get xml(){let n=this.from.flowNode==this.flowNode?$.j.PARENT:this.from.flowNode.id,o=this.to.flowNode==this.flowNode?$.j.PARENT:this.to.flowNode.id,g=this.group?` group="${this.group}"`:"",T=this.weight?` weight="${this.weight}"`:"",w="";return this.controlPoints&&this.controlPoints.map(t=>{w+=`<controlpoint x="${t.x}" y="${t.y}" visible="${t.visible}" percentage="${t.percentage}"/>`}),`<connection from="${n}.${this.from.name}" to="${o}.${this.to.name}"${g}${T}${this.scope?' scope="Def"':""}${this.checked?' checked="true"':""}>${w}</connection>`}get flowNode(){return this._flowNode}set flowNode(n){this._flowNode=n,this.updateJsonData()}mouseover(){this.mouseoverFlag=!0}mouseout(){this.mouseoverFlag=!1}initControlP(n){return n.controlpoint?(Array.isArray(n.controlpoint)||(n.controlpoint=[n.controlpoint]),n.controlpoint.map(o=>{this.controlPoints=[{x:Number(o.$_x),y:Number(o.$_y),visible:(0,y.sw)(o.$_visible),percentage:o.$_percentage}]}),this):this}addControlP(n){if(this.controlPoints)return this.controlPoints[0].visible=!0,void(this.controlPoints=[...this.controlPoints]);this.controlPoints=[{x:this.from.globalX+(this.to.globalX-this.from.globalX)/2,y:this.from.globalY+(this.to.globalY-this.from.globalY)/2,visible:!0,percentage:.5}],this.drawPath()}updateControlP(n=0,o=0){let g=this.controlPoints[0];if("h"===g.flag){if(o<10)return;g.y=o,g.percentage=Math.abs(g.y-this.from.globalY)/Math.abs(this.to.globalY-this.from.globalY)}else{if(n<this.from.globalX+20||n>this.to.globalX-20)return;g.x=n,g.percentage=Math.abs(g.x-this.from.globalX)/Math.abs(this.to.globalX-this.from.globalX)}this.drawPath()}updateControlPByNode(){let n=this.controlPoints[0];"h"===n.flag?n.y<this.from.globalY&&n.y<this.to.globalY||n.y>this.from.globalY&&n.y>this.to.globalY?n.x=this.from.globalX+.5*(this.to.globalX-this.from.globalX):(n.x=this.from.globalX+.5*(this.to.globalX-this.from.globalX),n.y=this.from.globalY+(this.to.globalY-this.from.globalY)*n.percentage):(n.x=this.from.globalX+(this.to.globalX-this.from.globalX)*n.percentage,n.y=this.from.globalY+.5*(this.to.globalY-this.from.globalY))}removeControlP(n){this.controlPoints=null,this.drawPath()}drawPath(n=0,o=0,g=0,T=0,w="",m=!1,u=!1){let t,e,i,r;if(w?(i={x:n,y:o},r={x:g,y:T},m?(t=r)&&(e=i):(t=i)&&(e=r),this.svgEndCircle.x=g,this.svgEndCircle.y=T):(t={x:this.from.globalX,y:this.from.globalY},e={x:this.to.globalX,y:this.to.globalY}),isNaN(t.x)||isNaN(t.y)||isNaN(e.x)||isNaN(e.y))return;let s_x=t.x+(e.x-t.x)/2,s_y=t.y+(e.y-t.y)/2,d=3;if(180*Math.abs(Math.atan((e.y-t.y)/(e.x-t.x)))/Math.PI<=15&&(d=2),e.x<=t.x&&(d=5),this.controlPoints&&(d=6),2===d)this.svgPath=`M${t.x} ${t.y} \n        S${(s_x+t.x)/2} ${t.y} ${s_x} ${s_y}\n        S${(s_x+e.x)/2} ${e.y} ${e.x} ${e.y}`;else if(3===d)this.svgPath=`M${t.x} ${t.y} \n        C${s_x} ${t.y} ${s_x} ${t.y} ${s_x} ${s_y}\n        C${s_x} ${e.y} ${s_x} ${e.y} ${e.x} ${e.y}`;else if(5===d){let p=20,h=t.x+p,_=e.x-p;this.svgPath=`M${t.x} ${t.y} \n        C${h} ${t.y} ${h} ${t.y} ${h} ${(s_y+t.y)/2}\n        C${h} ${s_y} ${h} ${s_y} ${s_x} ${s_y}\n        C${_} ${s_y} ${_} ${s_y} ${_} ${(s_y+e.y)/2}\n        C${_} ${e.y} ${_} ${e.y} ${e.x} ${e.y}`}else if(6===d){u&&this.updateControlPByNode();let p=t.x+20,h=this.controlPoints[0],A=e.x-20;e.x<=t.x?(this.svgPath=`M${t.x} ${t.y} \n          L${p-16} ${t.y}\n          C${p-16} ${t.y} ${p} ${t.y} ${p} ${t.y+16*(h.y>t.y?1:-1)}\n          L${p} ${h.y+16*(h.y>t.y?-1:1)}\n          C${p} ${h.y+16*(h.y>t.y?-1:1)} ${p} ${h.y} ${p-16} ${h.y}\n          L${A+16} ${h.y}\n          C${A+16} ${h.y} ${A} ${h.y} ${A} ${h.y+16*(h.y>e.y?-1:1)}\n          L${A} ${e.y+16*(h.y>e.y?1:-1)}\n          C${A} ${e.y+16*(h.y>e.y?1:-1)} ${A} ${e.y} ${A+16} ${e.y}\n          L${e.x} ${e.y}`,"h"!==h.flag&&(h.percentage=.5),h.flag="h"):(this.svgPath=`M${t.x} ${t.y} \n          L${h.x-16} ${t.y}\n          C${h.x-16} ${t.y} ${h.x} ${t.y} ${h.x} ${t.y+16*(h.y>t.y?1:-1)}\n          L${h.x} ${e.y+16*(h.y>e.y?1:-1)}\n          C${h.x} ${e.y+16*(h.y>e.y?1:-1)} ${h.x} ${e.y} ${h.x+16} ${e.y}\n          L${e.x} ${e.y}`,"v"!==h.flag&&(h.percentage=.5),h.flag="v")}this.svgPath1=`path('${this.svgPath.replace(/\n/g," ")}')`}}return N.SVG_DEBUG_CLASS="debug",N.SVG_NORMAL_CLASS="normal",N.SVG_HIGHLIGHT_CLASS="highlight",N.SVG_DASHARRAY_NONE="none",N.SVG_DASHARRAY_TRIGGER="8,5,3,5",N.SVG_DASHARRAY_TRIGGER1="2,4",N})()},70487:(b,E,c)=>{c.d(E,{k:()=>l});var y=c(57781),$=c(91139),P=c(94865);class l{constructor(){this.lattice=P.g,this.atom=!0}get cx(){return this.x+this.width/2}get cy(){return this.y+this.height/2}get jsonData(){return{id:this.id,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,parameters:this.parameters}}get graphXml(){var a;const n=this.lattice===P.g?"":` lattice="${this.lattice}"`;return`<fcomment id="${this.id}" name="${this.name}" x="${Math.round(this.x)}" y="${Math.round(this.y)}" width="${Math.round(this.width)}" height="${Math.round(this.height)}"${n}>${(null===(a=this.parameters)||void 0===a?void 0:a.getXml(!1))||""}</fcomment>`}initWithJsonData(a,n=!1){return this.id=a.id||a.$_id||(0,y.Vj)(),this.name=a.name||a.$_name,this.alias=this.name,this.x=Number(a.x||a.$_x)||100,this.y=Number(a.y||a.$_y)||100,this.width=Number(a.width||a.$_width)||200,this.height=Number(a.height||a.$_height)||200,this.lattice=a.lattice||a.$_lattice||P.g,a.parameters&&(this.parameters=$.n.parseParameters(a.parameters,this.id,n)),this}destroy(){}}},16817:(b,E,c)=>{c.d(E,{j:()=>w});var y=c(57781),$=c(46055),P=c(64203),l=c(5156),N=c(91139),a=c(31962),n=c(70487),o=c(40390);class g extends o._{constructor(){super(...arguments),this.width=4,this.height=10}get globalX(){var u,t;return this.portType===o._.TYPE_TRIGGER_IN_PORT?this.flowNode.x-this.flowNode.innerWidth*((null===(u=this.flowService)||void 0===u?void 0:u.scale)||1)/2:this.flowNode.x+this.flowNode.innerWidth*((null===(t=this.flowService)||void 0===t?void 0:t.scale)||1)/2}get globalY(){var u,t;return this.flowNode.y-this.flowNode.innerHeight*((null===(u=this.flowService)||void 0===u?void 0:u.scale)||1)/2+10*((null===(t=this.flowService)||void 0===t?void 0:t.scale)||1)}}var T=c(94865);let w=(()=>{class m{constructor(t=0){this.latticeArr=[],this.level=0,this.blink=!1,this.pColor=m.P_Color,this.pColor0=m.P_Color,this.bgColor=m.Bg_Color,this.normalBgColor=m.Bg_Color,this.selectedColor=m.Selected_Color,this.width=100,this.height=100,this.innerWidth=80,this.innerX=10,this.innerY=10,this.inportArr=[],this.outportArr=[],this.triggerInportArr=[],this.triggerOutportArr=[],this.mappingKNameVFlowPort={},this.subFlowNodeArr=[],this.parentFlowNode=null,this.connectionArr=[],this.commentArr=[],this.tagArr=[],this.level=t,this.initTriggerPort()}get type(){return this._type}set type(t){if(this._type=t,this.pColor=l.M6[this._type]||m.P_Color,this.pColor0=(0,y.PS)(this.pColor,.4),this.error)this.bgColor=this.normalBgColor="rgba(255,0,0,0.1)",this.selectedColor="rgba(255,0,0,0.4)";else{const e=(0,y.Nz)(this.pColor,"array");this.bgColor=this.normalBgColor=`hsl(${e[0]}, ${e[1]}%, 95%)`,this.selectedColor=`hsl(${e[0]}, ${e[1]}%, 85%)`}}get visible(){var t;return this.level===(null===(t=this.flowService)||void 0===t?void 0:t.currentLevel)}get error(){var t;return null===(t=this.flowService)||void 0===t?void 0:t.errorNodeIds.find(e=>e.id===this.id)}get innerHeight(){const t=Math.max(this.inportArr.length,this.outportArr.length);return t<=3?80:20*(t-3)+80}get outArr(){return this.outportArr.filter(t=>t.isOut)}get resultArr(){return this.outportArr.filter(t=>t.isResult)}get jsonData(){return{id:this.id,name:this.name,alias:this.alias||this.name,version:this.version,breaker:this.breaker,atom:this.atom,stackMode:this.stackMode,replica:this.replica,x:this.x||0,y:this.y||0,lattice:this.lattice,lattices:this.latticeArr&&this.latticeArr.length>1?this.latticeArr.map(t=>t.name).join(","):"",dependencyPolicy:this.dependencyPolicy,parameters:this.parameters,inport:this.inportArr.map(t=>t.jsonData),outport:this.outportArr.map(t=>t.jsonData),fnode:this.subFlowNodeArr.map(t=>t.jsonData),connect:this.connectionArr.map(t=>t.jsonData),fcomment:this.commentArr.map(t=>t.jsonData),tags:this.tagArr}}get graphXml(){let t=this.parameters?this.parameters.getXml():"",e="";this.inportArr.map(_=>{e+=_.xml});let i="";this.outportArr.map(_=>{i+=_.xml});let r="";this.subFlowNodeArr.map(_=>{r+=_.graphXml});let s="";this.connectionArr.map(_=>{s+=_.xml});let f="";this.commentArr.map(_=>{f+=_.graphXml});let d="";this.tagArr&&this.tagArr.length&&(d="<tags>",this.tagArr.map(_=>{d+=`<tag name="${_.name}" value="${_.value}" />`}),d+="</tags>");let p=this.lattice!==T.g?` lattice="${this.lattice}"`:"",h=this.latticeArr&&this.latticeArr.length>1?` lattices="${this.latticeArr.map(_=>_.name).join(",")}"`:"",A=this.dependencyPolicy?` dependencyPolicy="${this.dependencyPolicy}"`:"";return`<fnode id="${this.id}" name="${this.name}" alias="${this.alias||this.name}" atom="${this.atom}" stackMode="${this.stackMode}" x="${Math.round(this.x)||0}" y="${Math.round(this.y)||0}" replica="${this.replica}"${h}${p}${A}>${t}${e}${i}${r}${s}${f}${d}</fnode>`}get formatXml(){return(0,y.t6)(this.graphXml)}destroy(){this.inportArr.map(t=>t.destroy()),this.outportArr.map(t=>t.destroy()),this.subFlowNodeArr.map(t=>t.destroy()),this.connectionArr.map(t=>t.destroy()),this.commentArr.map(t=>t.destroy()),this.latticeArr.map(t=>t.destroy()),this.parameters=this.flowService=this.inportArr=this.outportArr=this.mappingKNameVFlowPort=this.connectionArr=this.commentArr=this.latticeArr=null}setFlowService(t){return this.flowService=t,this.triggerInportArr.map(e=>e.flowService=t),this.triggerOutportArr.map(e=>e.flowService=t),this}initTriggerPort(){this.addFlowPort((new g).initWithJsonData({name:o._.TYPE_TRIGGER_IN_PORT,portType:o._.TYPE_TRIGGER_IN_PORT})),this.addFlowPort((new g).initWithJsonData({name:o._.TYPE_TRIGGER_OUT_PORT,portType:o._.TYPE_TRIGGER_OUT_PORT}))}initWithJsonData(t){if(!t)return this;this.id=t.id||t.$_id||(0,y.Vj)(),this.name=t.name||t.$_name,this.alias=t.alias||t.$_alias||this.name,this.version=t.version,this.breaker=t.breaker,this.atom=(0,y.or)((0,y.or)(t.atom,t.$_atom),!0),this.stackMode=(0,y.or)((0,y.or)(t.stackMode,t.$_stackMode),!1),this.replica=Number(t.replica||t.$_replica||1),("ProcessOperator"===this.name||"ProcessReference"===this.name)&&(this.atom=!1),this.x=Number(t.x||t.$_x)||130,this.y=Number(t.y||t.$_y)||130,this.lattice=t.lattice||t.$_lattice||T.g,this.dependencyPolicy=t.dependencyPolicy||t.$_dependencyPolicy,t.parameters&&(this.parameters=N.n.parseParameters(t.parameters,this.id,!1));const e=t.lattices||t.$_lattices;if(e?e.split(",").map(i=>{this.latticeArr.push(new T.z(i).setNode(this))}):this.atom||this.latticeArr.push((new T.z).setNode(this)),t.tags&&t.tags.tag?(this.tagArr=Array.isArray(t.tags.tag)?t.tags.tag:[t.tags.tag],this.tagArr.map(i=>{i.name=i.name||i.$_name,i.value=i.value||i.$_value,"type"===i.name&&(this.type=i.value)})):Object.keys(l.M6).map(i=>{-1===this.name.indexOf(i)||(this.type=i)}),t.inport&&(Array.isArray(t.inport)||(t.inport=[t.inport]),t.inport.map(i=>{i.portType=o._.TYPE_IN_PORT,this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData(i))})),t.outport&&(Array.isArray(t.outport)||(t.outport=[t.outport]),t.outport.map(i=>{i.portType=o._.TYPE_OUT_PORT,this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData(i))})),t.fnode&&(Array.isArray(t.fnode)||(t.fnode=[t.fnode]),t.fnode.map(i=>{this.addSubFlowNode(new m(this.level+1).setFlowService(this.flowService).initWithJsonData(i))})),t.fcomment&&(Array.isArray(t.fcomment)||(t.fcomment=[t.fcomment]),t.fcomment.map(i=>{this.addComment((new n.k).initWithJsonData(i))})),!t.connect&&!t.connection)return this;t.connect=t.connection||t.connect,Array.isArray(t.connect)||(t.connect=[t.connect]);for(let i of t.connect){const r=this.parsePortFromConnection(i);!r||this.addConnection((new a.e).initWithFlowPort(r.fromPort,r.toPort).initControlP(i).updateOtherInfo(i))}return this}initWithOperator(t,e=!0){if(this.id=(0,y.Vj)(),this.name=t.name||t.$_name,this.alias=t.i18nText||t.alias||t.$_alias||this.name,this.atom=(0,y.or)((0,y.or)(t.atom,t.$_atom),!0),this.stackMode=(0,y.or)((0,y.or)(t.stackMode,t.$_stackMode),!1),this.replica=Number(t.replica||t.$_replica||1),this.resourceType=t.resourceType,this.resourceType===$.b0.PrcGraph&&(this.flowId=t.id)&&(this.flowName="ProcessReference"),this.dependencyPolicy=t.dependencyPolicy||t.$_dependencyPolicy,e){let i,r;if(this.type=t.type,this.tagArr.push({name:"type",value:this.type}),t.inputPorts){try{i=JSON.parse(t.inputPorts)}catch(s){i=t.inputPorts}i.map(s=>{s.portType=o._.TYPE_IN_PORT,this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData(s))})}if(t.outputPorts){try{r=JSON.parse(t.outputPorts)}catch(s){r=t.outputPorts}r.map(s=>{s.portType=o._.TYPE_OUT_PORT,this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData(s))})}}else t.inport&&(!Array.isArray(t.inport)&&(t.inport=[t.inport]),t.inport.map(i=>{i.portType=o._.TYPE_IN_PORT,this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData(i))})),t.outport&&(!Array.isArray(t.outport)&&(t.outport=[t.outport]),t.outport.map(i=>{i.portType=o._.TYPE_OUT_PORT,this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData(i))}));return t.parameters&&(this.parameters=N.n.parseParameters(t.parameters,this.id,e)),t.lattices?t.lattices.split(",").map(i=>{this.latticeArr.push(new T.z(i).setNode(this))}):this.atom||this.latticeArr.push((new T.z).setNode(this)),this}newFlowPort(t){const e=t.parentFlag===o._.PARENT_FNODE?t.dataType:"/";if(t.portType===o._.TYPE_IN_PORT)t.extendable&&!this.inportArr.filter(i=>i.extendable).find(i=>i.numConnection<=0)&&(this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData({name:this.generateInportName(t.name),portType:o._.TYPE_IN_PORT,dataType:e,type:t.type,option:t.option,extendable:t.extendable,connectionLimit:t.connectionLimit})),this.drawPathByFlowPort());else if(t.portType===o._.TYPE_OUT_PORT){const i=t.isOut?this.outArr:this.resultArr;t.extendable&&!i.filter(r=>r.extendable).find(r=>r.numConnection<=0)&&(this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData({name:this.generateOutportName(i,t.name),portType:o._.TYPE_OUT_PORT,dataType:e,type:t.type,option:t.option,extendable:t.extendable,connectionLimit:t.connectionLimit})),this.drawPathByFlowPort())}}generateInportName(t){var e;t=null===(e=t.match(/[a-zA-Z]+/))||void 0===e?void 0:e[0];let i=1;return this.inportArr.map(r=>{let s=Number(r.name.replace(t,""));!isNaN(s)&&s>=i&&(i=s+1)}),t+i}generateOutportName(t,e){var i;e=null===(i=e.match(/[a-zA-Z]+/))||void 0===i?void 0:i[0];let r=1;return t.map(s=>{let f=Number(s.name.replace(e,""));!isNaN(f)&&f>=r&&(r=f+1)}),e+r}drawPathByFlowPort(){setTimeout(()=>{this.connectionArr&&this.connectionArr.map(t=>t.drawPath())})}addFlowPort(t){if(!t||this.mappingKNameVFlowPort[t.name])return t;switch(t.flowNode&&t.flowNode.removeFlowPort(t),t.flowNode=this,this.mappingKNameVFlowPort[t.name]=t,t.portType){case o._.TYPE_IN_PORT:this.inportArr=[...this.inportArr,t];break;case o._.TYPE_OUT_PORT:this.outportArr=[...this.outportArr,t];break;case o._.TYPE_TRIGGER_IN_PORT:this.triggerInportArr=[...this.triggerInportArr,t];break;case o._.TYPE_TRIGGER_OUT_PORT:this.triggerOutportArr=[...this.triggerOutportArr,t]}return t}removeFlowPort(t){if(!t||!this.mappingKNameVFlowPort[t.name])return t;switch(t.flowNode=null,delete this.mappingKNameVFlowPort[t.name],t.portType){case o._.TYPE_IN_PORT:this.inportArr=this.inportArr.filter((e,i)=>i!==this.inportArr.indexOf(t)),this.drawPathByFlowPort();break;case o._.TYPE_OUT_PORT:this.outportArr=this.outportArr.filter((e,i)=>i!==this.outportArr.indexOf(t)),this.drawPathByFlowPort();break;case o._.TYPE_TRIGGER_IN_PORT:this.triggerInportArr=this.triggerInportArr.filter((e,i)=>i!==this.triggerInportArr.indexOf(t));break;case o._.TYPE_TRIGGER_OUT_PORT:this.triggerOutportArr=this.triggerOutportArr.filter((e,i)=>i!==this.triggerOutportArr.indexOf(t))}return t.destroy(),t}addFlowPortByAlias(t,e=""){let i,r,s,f,d;e===o._.TYPE_IN_PORT?(i=this.inportArr,s=i[i.length-1],r=t+"In",d=o._.TYPE_IN_PORT):e===o._.TYPE_RESULT_PORT?(i=this.resultArr,s=i[i.length-1],r=t+"Out",d=o._.TYPE_OUT_PORT):(i=this.outArr,s=i[i.length-1],r=t+"Out",d=o._.TYPE_OUT_PORT),s&&(f=s.parentFlag===o._.PARENT_FNODE?s.dataType:"/",this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData({name:r,alias:t,portType:d,dataType:f,option:s.option,extendable:s.extendable,connectionLimit:s.connectionLimit})))}removeFlowPortByAlias(t,e=""){let i,r;i=e===o._.TYPE_IN_PORT?this.inportArr:e===o._.TYPE_RESULT_PORT?this.resultArr:this.outArr,r=i.find(s=>s.alias===t),r&&(r.numConnection>0&&this.parentFlowNode.connectionArr.filter(s=>s.from===r||s.to===r).map(s=>{this.parentFlowNode.removeConnection(s)}),r.breakpoint&&this.flowService.notify.notify(P.g.DeleteBreakpointWhenDeletePort,r.breakpoint),this.removeFlowPort(r))}renameFlowPort(t,e,i=""){let r,s;r=i===o._.TYPE_IN_PORT?this.inportArr:i===o._.TYPE_RESULT_PORT?this.resultArr:this.outArr,s=r.find(f=>f.alias===t),s&&(s.alias=e)}updateFlowPortByParameter(t){const e=d=>{d.map(p=>{p.numConnection>0&&this.parentFlowNode.connectionArr.filter(h=>h.from===p||h.to===p).map(h=>{this.parentFlowNode.removeConnection(h)}),p.breakpoint&&this.flowService.notify.notify(P.g.DeleteBreakpointWhenDeletePort,p.breakpoint),p.flowNode=null,delete this.mappingKNameVFlowPort[p.name],this.outportArr=this.outportArr.filter((h,A)=>A!==this.outportArr.indexOf(p)),p.destroy()})};if(!t||!t.value)return void e(this.outportArr.concat([]));const r=this.outportArr.filter(d=>t.value.find(p=>d.name===p.portName.value)),s=this.outportArr.filter(d=>-1===r.indexOf(d)),f=t.value.filter(d=>!r.find(p=>p.name===d.portName.value));e(s),(d=>{d.map(p=>{this.addFlowPort((new o._).setFlowService(this.flowService).initWithJsonData({name:p.portName.value,flowDataType:p.flowDataType.value,portType:o._.TYPE_OUT_PORT,option:!0}))})})(f)}getFlowPortByName(t){return this.mappingKNameVFlowPort[t]}addSubFlowNode(t,e=-1){return!t||-1!==this.subFlowNodeArr.indexOf(t)||(t.parentFlowNode&&t.parentFlowNode.removeSubFlowNode(t),t.parentFlowNode=this,e<0?this.subFlowNodeArr=[...this.subFlowNodeArr,t]:this.subFlowNodeArr.splice(e,0,t)),t}removeSubFlowNode(t){return!t||-1===this.subFlowNodeArr.indexOf(t)||(t.parentFlowNode=null,this.subFlowNodeArr=this.subFlowNodeArr.filter((e,i)=>i!==this.subFlowNodeArr.indexOf(t)),t.inportArr.map(e=>{e.breakpoint&&this.flowService.notify.notify(P.g.DeleteBreakpointWhenDeletePort,e.breakpoint)}),t.outportArr.map(e=>{e.breakpoint&&this.flowService.notify.notify(P.g.DeleteBreakpointWhenDeletePort,e.breakpoint)}),t.destroy()),t}getSubFlowNodeById(t,e=!1){const i=(r,s)=>{let f=s.subFlowNodeArr.find(d=>d.id===r);if(f)return f;for(let d=0;d<s.subFlowNodeArr.length&&(f=i(r,s.subFlowNodeArr[d]),!f);d++);return f};return e?i(t,this):this.subFlowNodeArr.find(r=>r.id===t)}getLevelPath(t,e=!0){const i=[],r=this.getSubFlowNodeById(t,!0);if(!r)return i;i.push(r);let s=r.parentFlowNode;for(;s;)e&&(s.subFlowNodeDebugging=!0),i.push(s),s=s.parentFlowNode;return i.reverse()}getFromFlowNodes(t,e=""){let s,i=this.getSubFlowNodeById(t),r=[];return i&&(s=i.inportArr.filter(f=>f.numConnection),e&&(s=s.filter(f=>0===f.dataType.indexOf(e))),s.map(f=>{this.connectionArr.map(d=>{d.to===f&&r.push(d.from.flowNode)})})),r}getToFlowNodes(t){let e=this.getSubFlowNodeById(t),i=[];return e&&e.outportArr.filter(r=>r.numConnection).map(r=>{this.connectionArr.map(s=>{s.from===r&&i.push(s.to.flowNode)})}),i}getTreeNode(){return{title:this.alias,name:this.name,key:this.id,isLeaf:!0,error:!!this.error}}getFlowTree(){let t=this.getTreeNode();return this.subFlowNodeArr.length&&(t.isLeaf=!1,t.expanded=!0,t.children=[],this.subFlowNodeArr.map(e=>{t.children.push(e.getFlowTree())})),t}addConnection(t){return!t||-1!==this.connectionArr.indexOf(t)||(t.flowNode&&t.flowNode.removeConnection(t),t.flowNode=this,this.connectionArr=[...this.connectionArr,t],setTimeout(()=>{t.drawPath()}),this.updatePortDataType(t),this.updateConnectionType()),t}removeConnection(t){if(!t||-1===this.connectionArr.indexOf(t))return t;if(t.flowNode=null,t.from.numFromConnection--,t.from.connectionScope="",t.to.numToConnection--,t.to.connectionScope="",this.connectionArr=this.connectionArr.filter((e,i)=>i!==this.connectionArr.indexOf(t)),t.from.numConnection<=0){let e=t.from.flowNode;t.from.extendable&&e.removeFlowPort(t.from),e.atom&&(t.from.flowMeta="")}if(t.to.numConnection<=0){let e=t.to.flowNode;t.to.extendable&&e.removeFlowPort(t.to),e.atom&&(t.to.flowMeta="")}return this.updatePortDataType(t),this.updateConnectionType(),t.destroy(),t}getConnection(t,e){return this.connectionArr.find(i=>i.from===t&&i.to===e||i.from===e&&i.to===t)}parsePortFromConnection(t){let e=(t.from||t.$_from).split("."),i=(t.to||t.$_to).split("."),r=e[0],s=e[1],f=i[0],d=i[1],p=r===m.PARENT?this:this.getSubFlowNodeById(r),h=f===m.PARENT?this:this.getSubFlowNodeById(f);if(!p||!h)return!1;let A=p.getFlowPortByName(s),_=h.getFlowPortByName(d);return!(!A||!_)&&(A.parentFlag=p===this?o._.PARENT_CONTAINER:o._.PARENT_FNODE,_.parentFlag=h===this?o._.PARENT_CONTAINER:o._.PARENT_FNODE,{fromPort:A,toPort:_})}addComment(t){return!t||-1!==this.commentArr.indexOf(t)||(this.commentArr=[...this.commentArr,t]),t}removeComment(t){return!t||-1===this.commentArr.indexOf(t)||(this.commentArr=this.commentArr.filter((e,i)=>i!==this.commentArr.indexOf(t))),t}updateConnectionType(){this.subFlowNodeArr.map(t=>{var e;(null===(e=t.outportArr.find(i=>"pazOut"===i.name))||void 0===e?void 0:e.numConnection)?this.connectionArr.filter(i=>"pazOut"!==i.from.name&&"pazOut"!==i.to.name).filter(i=>"Def"!==i.scope).map(i=>{(i.from.flowNode===t||i.to.flowNode===t)&&(i.svgDasharray=a.e.SVG_DASHARRAY_TRIGGER1,i.scope=i.from.connectionScope=i.to.connectionScope="Def")}):t.inportArr.some(r=>"Def"===r.connectionScope)&&t.outportArr.some(r=>"Def"===r.connectionScope)&&this.connectionArr.filter(r=>"pazOut"!==r.from.name&&"pazOut"!==r.to.name).filter(r=>"Def"!==r.scope).map(r=>{(r.from.flowNode===t||r.to.flowNode===t)&&(r.svgDasharray=a.e.SVG_DASHARRAY_TRIGGER1,r.scope=r.from.connectionScope=r.to.connectionScope="Def")})})}updatePortDataType(t){this.parentFlowNode||t.from.parentFlag===o._.PARENT_FNODE&&t.to.parentFlag===o._.PARENT_FNODE||!this.atom&&(this.inportArr.find(e=>e.type===o._.TYPE_EXTERNAL)||this.outportArr.find(e=>e.type===o._.TYPE_EXTERNAL))||(this.inportArr.map(e=>{e.dataType="/"}),this.inportArr.filter(e=>e.numConnection>0).map(e=>{this.connectionArr.filter(r=>r.from===e).map(r=>r.to).map(r=>{e.dataType=e.dataType.length>r.dataType.length?e.dataType:r.dataType})}),this.outportArr.map(e=>{e.dataType="/"}),this.outportArr.filter(e=>e.numConnection>0).map(e=>{const i=this.connectionArr.filter(r=>r.to===e).map(r=>r.from);1===i.length?e.dataType=i[0].dataType:i.map(r=>{e.dataType=e.dataType.length>r.dataType.length?r.dataType:e.dataType})}))}}return m.PARENT="parent",m.P_Color="#2a8b92",m.Bg_Color="#fbffff",m.Selected_Color="#d9fbfd",m})()},40390:(b,E,c)=>{c.d(E,{_:()=>P});var y=c(57781),$=c(94865);let P=(()=>{class l{constructor(){this.connectionScope="",this.width=20,this.height=20,this.parentFlag="fnode",this.numFromConnection=0,this.numToConnection=0}get numConnection(){return this.numFromConnection+this.numToConnection}get jsonData(){return{name:this.name,alias:this.alias,dataType:this.dataType,option:this.option,extendable:this.extendable||!1,connectionLimit:this.connectionLimit,type:this.type,lattice:this.lattice,flowMeta:this.flowMeta,visible:this.visible}}get xml(){const a=isNaN(this.connectionLimit)?"":' connectionLimit="'+this.connectionLimit+'"';return`<${this.portType} name="${this.name}" alias="${this.alias}" dataType="${this.dataType||""}" option="${this.option||!0}" extendable="${this.extendable||!1}"${a}${this.type?' type="'+this.type+'"':""}${this.lattice!==$.g?' lattice="'+this.lattice+'"':""}${this.visible?' visible="'+this.visible+'"':""}>${this.flowMeta?`<flowMeta><![CDATA[${this.flowMeta}]]></flowMeta>`:""}</${this.portType}>`}destroy(){this.nativeElement=this.aliasNativeElement=this.flowNode=this.flowService=null}setFlowService(a){return this.flowService=a,this}initWithJsonData(a){var n;return this.name=a.name||a.$_name,this.alias=a.alias||a.$_alias||this.name,this.portType=a.portType,this.dataType=a.flowDataType||a.dataType||a.$_dataType,this.option=(0,y.or)((0,y.or)(a.option,a.$_option),!0),this.extendable=(0,y.or)(a.extendable,a.$_extendable),this.connectionLimit=a.connectionLimit||a.$_connectionLimit,this.type=a.type||a.$_type,this.lattice=a.lattice||a.$_lattice||$.g,this.flowMeta=(null===(n=a.flowMeta)||void 0===n?void 0:n.__cdata)||a.flowMeta||"",this.visible=a.visible||a.$_visible,this}get isOut(){return this.portType===l.TYPE_OUT_PORT&&-1===this.name.toLocaleLowerCase().indexOf(l.TYPE_RESULT_PORT)}get isResult(){return-1!==this.name.toLocaleLowerCase().indexOf(l.TYPE_RESULT_PORT)}get globalX(){var a,n,o,g,T,w,m,u;return this.portType===l.TYPE_IN_PORT?this.parentFlag===l.PARENT_CONTAINER?this.type===l.TYPE_EXTERNAL||this.type===l.TYPE_THROUGH?(null===(a=this.latticeM)||void 0===a?void 0:a.scrollX)+this.width/2-10:(null===(n=this.latticeM)||void 0===n?void 0:n.scrollX)+this.width/2:this.flowNode.x-this.flowNode.innerWidth*((null===(o=this.flowService)||void 0===o?void 0:o.scale)||1)/2:this.parentFlag===l.PARENT_CONTAINER?this.type===l.TYPE_EXTERNAL||this.type===l.TYPE_THROUGH?(null===(g=this.latticeM)||void 0===g?void 0:g.scrollX)+(null===(T=this.latticeM)||void 0===T?void 0:T.w)-this.width/2+10:(null===(w=this.latticeM)||void 0===w?void 0:w.scrollX)+(null===(m=this.latticeM)||void 0===m?void 0:m.w)-this.width/2:this.flowNode.x+this.flowNode.innerWidth*((null===(u=this.flowService)||void 0===u?void 0:u.scale)||1)/2}get globalY(){var a,n,o,g,T,w,m,u,t,e;return this.parentFlag===l.PARENT_CONTAINER?this.isOut?(null===(a=this.latticeM)||void 0===a?void 0:a.scrollY)+(null===(n=this.latticeM)||void 0===n?void 0:n.h)/2+(null===(o=this.nativeElement)||void 0===o?void 0:o.offsetTop)+this.height/2:(null===(g=this.latticeM)||void 0===g?void 0:g.scrollY)+(null===(T=this.nativeElement)||void 0===T?void 0:T.offsetTop)+this.height/2:this.flowNode.y-this.flowNode.height*((null===(w=this.flowService)||void 0===w?void 0:w.scale)||1)/2+(null===(m=this.nativeElement)||void 0===m?void 0:m.offsetTop)*((null===(u=this.flowService)||void 0===u?void 0:u.scale)||1)+this.height*((null===(t=this.flowService)||void 0===t?void 0:t.scale)||1)/2+30*((null===(e=this.flowService)||void 0===e?void 0:e.scale)||1)}get tipX(){return this.portType===l.TYPE_IN_PORT?this.parentFlag===l.PARENT_CONTAINER?this.globalX+10:this.globalX-this.aliasNativeElement.offsetWidth-20:this.parentFlag===l.PARENT_CONTAINER?this.globalX-this.aliasNativeElement.offsetWidth-20:this.globalX+10}get tipY(){var a;return this.numConnection&&this.parentFlag===l.PARENT_FNODE?this.globalY-((null===(a=this.breakpoint)||void 0===a?void 0:a.debugging)?43:this.flowService.readonly?14:21):this.globalY-14}}return l.TYPE_IN_PORT="inport",l.TYPE_OUT_PORT="outport",l.TYPE_RESULT_PORT="result",l.TYPE_TRIGGER_IN_PORT="triggerIn",l.TYPE_TRIGGER_OUT_PORT="triggerOut",l.PARENT_FNODE="fnode",l.PARENT_CONTAINER="container",l.TYPE_THROUGH="THROUGH",l.TYPE_EXTERNAL="EXTERNAL",l.TYPE_INTERNAL="INTERNAL",l})()},94865:(b,E,c)=>{c.d(E,{g:()=>y,z:()=>$});const y="default";class ${constructor(l=y){this.scrollX=0,this.scrollY=0,this.subW=0,this.subH=0,this.name=l}get index(){return this.node.latticeArr.indexOf(this)}get length(){return this.node.latticeArr.length}get x(){return 1===this.length?0:this.index*this.w+7*(this.index+1)}get y(){return 0}get w(){return 1===this.length?this.node.flowService.containerW:(this.node.flowService.containerW-7)/this.length-7}get h(){return this.node.flowService.containerH}setNode(l){return this.node=l,this}destroy(){}}}}]);